<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Registro - Orario Settimanale</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#f8f8f8; }
    header { background:#0073b7; color:white; padding:10px; text-align:center; font-size:18px; font-weight:bold; }
    nav { background:#004a80; padding:10px; display:flex; gap:20px; }
    nav a { color:white; text-decoration:none; font-weight:bold; }
    nav a:hover { text-decoration:underline; }

    .top-bar { display:flex; justify-content:space-between; align-items:center; background:#ddd; padding:10px; flex-wrap:wrap; }
    select { padding:5px; font-size:14px; }

    .settimane { display:flex; flex-wrap:wrap; max-width:600px; }
    .settimana { width:35px; margin:2px; text-align:center; padding:5px; background:white; border:1px solid #aaa; cursor:pointer; border-radius:5px; font-size:12px; }
    .settimana.active { background:#0073b7; color:white; font-weight:bold; }

    table { border-collapse:collapse; width:100%; margin-top:10px; background:white; }
    th, td { border:1px solid #ccc; text-align:center; padding:5px; font-size:12px; }
    .orari { width:60px; font-weight:bold; background:#f9f9f9; }
    .griglia td { height:35px; cursor:pointer; }

    .lezione { background:#d0ebff; border:1px solid #0073b7; border-radius:4px; font-size:11px; padding:2px; }
    .lezione button { margin-top:3px; font-size:10px; }

    .modal {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center;
    }
    .modal-content {
      background:white; padding:20px; border-radius:10px; width:350px;
    }
    .modal-content h3 { margin-top:0; }
    .modal-content label { display:block; margin-top:10px; font-size:13px; }
    .modal-content select, .modal-content input { width:100%; padding:5px; margin-top:3px; }
    .modal-content button { margin-top:10px; padding:5px 10px; }
  </style>
</head>
<body>
  <header>Registro - Orario Settimanale</header>
  <nav>
    <a href="area_docenti.html">Home</a>
    <a href="attivita.html">Attività</a>
    <a href="voti.html">Voti</a>
    <a href="orario.html">Orario</a>
    <a href="index.html">LOG OUT</a>
  </nav>

  <!-- Barra superiore -->
  <div class="top-bar">
    <div>
      Classe: 
      <select id="classeSelect" onchange="cambiaClasse()">
        <option value="1">1ª Superiore</option>
        <option value="2">2ª Superiore</option>
      </select>
    </div>
    <div class="settimane" id="listaSettimane"></div>
  </div>

  <!-- Tabella registro -->
  <div id="registro-container"></div>

  <!-- Modal per creare lezione -->
  <div class="modal" id="creaLezioneModal">
    <div class="modal-content">
      <h3>Crea Lezione</h3>
      <label>Materia:</label>
      <select id="materiaInput">
        <option>Italiano</option><option>Matematica</option><option>Storia</option>
        <option>Geografia</option><option>Informatica</option><option>Arte</option>
        <option>Musica</option><option>Ginnastica</option><option>Accoglienza</option>
        <option>Orientamento</option><option>Recupero</option><option>Sicurezza</option><option>Disegno</option>
      </select>
      </select>
      <label>Docente:</label>
      <select id="docenteInput">
        <option>ENRICO DEMATTEIS</option><option>PIKKY POMODORO</option><option>PIPPY ANANAS</option>
        <option>SPINACI VERDI</option><option>ALESSIA DEMATTEIS</option><option>DAVIDE FROLLINO</option>
        <option>INSALATA RUSSA</option>
      </select>
      <label>Ora di inizio:</label>
      <input type="number" id="oraInizioInput" min="7" max="22" value="8">
      <label>Durata (ore):</label>
      <input type="number" id="durataInput" min="1" max="5" value="1">
      <button onclick="creaLezione()">Crea</button>
      <button onclick="chiudiModal('creaLezioneModal')">Annulla</button>
    </div>
  </div>

  <!-- Modal Appello -->
  <div class="modal" id="appelloModal">
    <div class="modal-content">
      <h3>Appello</h3>
      <div id="listaStudenti"></div>
      <button onclick="salvaAppello()">Completa</button>
      <button onclick="chiudiModal('appelloModal')">Chiudi</button>
    </div>
  </div>

  <script>
    let settimanaCorrente = null;
    let classeCorrente = "1";
    let registroDati = JSON.parse(localStorage.getItem("registroDati")) || {};

    const studenti = {
      "1": ["DEMATTEIS STELLINA","DEMATTEIS PANDINO","BENUA TARTARUGA","BENUA YUCKY","BENUA LOLLO","DEMATTEIS BRICIOLA","DEMATTEIS FLUFFY","DEMATTEIS TINA","BENUA GRIGETTA","DEMATTEIS LUNA","BENUA LUNA","DEMATTEIS KENDY","DEMATTEIS PAPERO","DEMATTEIS ATTIGLIO","DEMATTEIS CURT","BENUA BUNNY","BENUA SUNNY],
      "2": ["DEMATTEIS CANE","BENUA CANE","DEMATTEIS MICIAN","TEMPERINI CICCIOBELLO","CAROTINI MAICOL","TEMPERINI CATTIVO","CAROTINI BAMBOLA","ROSETTI ROBOTTINA"]
    };

    function salvaDati() {
      localStorage.setItem("registroDati", JSON.stringify(registroDati));
    }

    function getKey(week, day, hour) {
      return `${classeCorrente}_${week}_${day}_${hour}`;
    }

    function generaSettimane() {
      let lista = document.getElementById("listaSettimane");
      lista.innerHTML = "";
      for (let i = 1; i <= 52; i++) {
        let div = document.createElement("div");
        div.className = "settimana";
        div.innerText = i;
        div.onclick = () => selezionaSettimana(div, i);
        lista.appendChild(div);
      }
    }

    function selezionaSettimana(el, settimana) {
      document.querySelectorAll(".settimana").forEach(s => s.classList.remove("active"));
      el.classList.add("active");
      settimanaCorrente = settimana;
      loadTimetable();
    }

    function loadTimetable() {
      if (!settimanaCorrente) return;
      let giorni = ["Lun","Mar","Mer","Gio","Ven","Sab"];
      let html = `<table class="griglia"><tr><th class="orari"></th>`;
      giorni.forEach(g => html += `<th>${g}</th>`);
      html += `</tr>`;
      for (let h = 7; h <= 22; h++) {
        html += `<tr><td class="orari">${h}:00</td>`;
        for (let d = 0; d < giorni.length; d++) {
          let key = getKey(settimanaCorrente, d, h);
          let lezione = registroDati[key];
          if (lezione) {
            html += `<td class="lezione" onclick="apriAppello('${key}')">${lezione.materia}<br>${lezione.docente}<br><button>Svolgi Appello</button></td>`;
          } else {
            html += `<td onclick="apriCreaLezione(${d},${h})"></td>`;
          }
        }
        html += `</tr>`;
      }
      html += `</table>`;
      document.getElementById("registro-container").innerHTML = html;
    }

    let cellaSelezionata = null;
    function apriCreaLezione(day,hour) {
      cellaSelezionata = {day,hour};
      document.getElementById("creaLezioneModal").style.display="flex";
    }

    function creaLezione() {
      let materia = document.getElementById("materiaInput").value;
      let docente = document.getElementById("docenteInput").value;
      let oraInizio = parseInt(document.getElementById("oraInizioInput").value);
      let durata = parseInt(document.getElementById("durataInput").value);
      for (let i=0;i<durata;i++){
        let key = getKey(settimanaCorrente,cellaSelezionata.day,oraInizio+i);
        registroDati[key] = {materia,docente,appello:{}};
      }
      salvaDati();
      chiudiModal('creaLezioneModal');
      loadTimetable();
    }

    let keyAppello = null;
    function apriAppello(key) {
      keyAppello = key;
      let dati = registroDati[key];
      let lista = document.getElementById("listaStudenti");
      lista.innerHTML = "";
      studenti[classeCorrente].forEach(nome => {
        let stato = dati.appello[nome] || "assente";
        lista.innerHTML += `<div>
          ${nome} 
          <select id="stato_${nome}">
            <option value="presente" ${stato=="presente"?"selected":""}>Presente</option>
            <option value="assente" ${stato=="assente"?"selected":""}>Assente</option>
          </select>
        </div>`;
      });
      document.getElementById("appelloModal").style.display="flex";
    }

    function salvaAppello() {
      let dati = registroDati[keyAppello];
      studenti[classeCorrente].forEach(nome => {
        let stato = document.getElementById("stato_"+nome).value;
        dati.appello[nome] = stato;
      });
      salvaDati();
      chiudiModal("appelloModal");
    }

    function chiudiModal(id) {
      document.getElementById(id).style.display="none";
    }

    function cambiaClasse() {
      classeCorrente = document.getElementById("classeSelect").value;
      loadTimetable();
    }

    // Avvio
    generaSettimane();
    selezionaSettimana(document.querySelector(".settimana"),1);
  </script>
</body>
</html>



